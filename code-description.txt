# Larashard â€“ Laravel UserÂ ShardingÂ Demo

**Larashard** is a demo LaravelÂ 10Â application that shows how to implement a simple horizontal sharding pattern. Users live in a primary database, while each userâ€™s related data (addresses) are written to one of three shard databases chosen with a modulusâ€‘hash strategy.

---

## ğŸ Â Project Structure

```text
app/
â”œâ”€ Http/
â”‚  â”œâ”€ Controllers/
â”‚  â””â”€ Requests/
â”œâ”€ Models/
â”‚  â”œâ”€ User.php
â”‚  â””â”€ Address.php
â”œâ”€ ShardResolver.php
â””â”€
```

## Databases

| Connection        | Purpose                       |
| ----------------- | ----------------------------- |
| `laravel`         | Primary DB â€“Â storesÂ `users`   |
| `laravel_shard_1` | Shard DB â€“Â storesÂ `addresses` |
| `laravel_shard_2` | Shard DB â€“Â storesÂ `addresses` |
| `laravel_shard_3` | Shard DB â€“Â storesÂ `addresses` |

## ğŸ–¥Â APIÂ Reference

| Method | Endpoint             | Description                      |
| ------ | -------------------- | -------------------------------- |
| POST   | `/api/v1/users`      | Create user + addresses          |
| PUT    | `/api/v1/users/{id}` | Update user + addresses          |
| GET    | `/api/v1/users`      | List users (with addresses)      |
| GET    | `/api/v1/users/{id}` | Get single user (with addresses) |
| DELETE | `/api/v1/users/{id}` | Delete user + addresses          |

## ğŸ§  HowÂ ItÂ Works

- User write â†’ main DB (laravel).
- System calculates shard, updates db_connection.
- Address write â†’ chosen shard DB.
- Relationship dynamically selects the shard via db_connection.
- Deletes cascade via model event.
